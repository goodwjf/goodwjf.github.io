(function(e){var t=function(){if(!(this instanceof t))return new t(arguments);var e="idle",n,r={},i={resolved:[],rejected:[]},s={},o={resolved:[],rejected:[]},u=Array.prototype.slice.call(arguments),a=function(e,t){for(var n in e)if(n===t)return!0;return!1},f=function(e,t){return e.indexOf(t)>-1},l=f(u,"standalone"),c=f(u,"hold"),h=[],p=this;this.listeners=i,this.once_listeners=o;var d=function(e,t){if(!e)return;if(e.length===+e.length)for(var n=0,r=e.length;n<r;n++)t&&t(e[n],n);else if(typeof e=="object")for(var i in e)t&&t(e[i],i)},v=function(){return e="idle",n=undefined,l=f(u,"standalone"),c=f(u,"hold"),h=[],this};this.reset=v,this.isIdle=function(){return e==="idle"};var m=function(){return e==="pending"},g=function(e){n=e},y=function(){return n},b=function(t){e=t};this.pend=function(){b("pending")};var w=function(){return e};this.getState=w;var E=function(){return e==="resolved"},S=function(){return e==="resolved"||e==="rejected"},x=function(){var e=w(),t=y();d(i[e],function(e){e(t)}),d(o[e],function(e){e(t)}),_()},T=function(){for(var e,t=0;e=h[t];t++)e.resolvePromise(p)},N=function(){b("idle"),g(null),h=[],M()},C=function(){!c&&l&&N()};this.resumeIfAllowed=function(){!c&&!l&&N()};var k=function(){x(),T()};this.getMessage=y,this.isCompleted=S,this.addListener=function(e){h.push(e)};var L=function(){k(),C()},A=null,O=function(){clearTimeout(A),A=setTimeout(function(){E()&&L()},1)};this.resolve=function(e){if(c||!S())g(e),b("resolved"),k(),C();return this},this.reject=function(e){if(c||!S())g(e),b("rejected"),k(),C();return this};var M=this.clear=function(){r={},i.resolved.length=0,i.rejected.length=0},_=this.clearOnce=function(){s={},o.resolved.length=0,o.rejected.length=0};this.then=function(e,t,n,s){if(c||!S())r[e]=1,i.resolved.push(t),i.rejected.push(n);return E()&&O(),this},this.thenOnce=function(e,t,n){if(c||!S())s[e]=1,o.resolved.push(t),o.rejected.push(n);return E()&&O(),this},this.isPromised=function(e){var t=!1;return a(r,e)?t=!0:a(s,e)&&(t=!0),t}};e.Promise=t})(this);